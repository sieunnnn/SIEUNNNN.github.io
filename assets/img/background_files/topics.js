(()=>{"use strict";var t={113:function(t,e,n){var s=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))((function(i,o){function a(t){try{r(s.next(t))}catch(t){o(t)}}function c(t){try{r(s.throw(t))}catch(t){o(t)}}function r(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}r((s=s.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.EModuleStorageKeys=e.EConsentStatus=e.Consent=void 0;const i=n(882);var o,a;e.Consent=class{constructor(){this.consentTgtString="consent=rejected",this.maxSearchEntry=50,this.consentRejectedKey="sas_consent_rejected",this.cmpValidKey="eqtv_cmpvalid",this.consentStatus=o.UNKNOWN,this.tcfData={},this.retryInterval=0,this.retryNumber=0,this.retryTime=500,this.logOn=!1,this.validateTCFData=()=>{var t;this.log("validateTCFData");const{tcData:e,success:n}=this.tcfData;if(e&&!this.isCmpValid(e.cmpId))return this.consentStatus=o.REJECTED,void this.callCallback();if(this.isUiVisible(null==e?void 0:e.eventStatus))return this.consentStatus===o.UNKNOWN&&(null==e?void 0:e.gdprApplies)&&(this.consentStatus=o.REJECTED),void this.callCallback();const s=!0===(null===(t=null==e?void 0:e.vendor)||void 0===t?void 0:t.consents[45])&&[1,2,4,7,10].every((t=>{var n;return!0===(null===(n=e.purpose)||void 0===n?void 0:n.consents[t])}));n&&e&&(!1===e.gdprApplies||s?this.consentStatus=o.AGREED:void 0===e.gdprApplies?this.consentStatus=s?o.AGREED:o.REJECTED:this.consentStatus=o.REJECTED),this.callCallback()},window.sas=window.sas||{},window.sas.EConsentStatus=o,window.sas.getConsentStatus=()=>this.getConsentStatus(),"function"!=typeof window.__gpp&&"function"!=typeof window.__tcfapi&&(this.consentStatus=o.AGREED),this.checkConsentInStorage()}checkConsent(t){return s(this,void 0,void 0,(function*(){this.log("checkConsent",t),this.callback=t,this.callCallback(),yield this.checkGPPConsent(),"function"!=typeof window.__gpp&&this.checkTCFConsent()}))}getConsentStatus(){return this.consentStatus}checkConsentInStorage(){this.log("checkConsentStatus");const t=window.sas.localStorage.getItem(this.consentRejectedKey);"1"===t?this.consentStatus=o.REJECTED:"0"===t&&(this.consentStatus=o.AGREED),this.callCallback()}getGPPData(){this.log("getGPPData"),window.__gpp("addEventListener",(t=>s(this,void 0,void 0,(function*(){if(!t)return void console.warn("No consent data available");let e;if(Number(t.pingData.gppVersion)<1.1){const n=window.__gpp("getGPPData");e={cmpId:t.pingData.cmpId,cmpDisplayStatus:t.pingData.cmpDisplayStatus,applicableSections:n.applicableSections}}else{const n=t.pingData;e={cmpId:n.cmpId,cmpDisplayStatus:n.cmpDisplayStatus,applicableSections:n.applicableSections}}yield this.validateGPPData(e)}))))}createRetryInterval(){this.log("createRetryInterval");const t=this.getTopWindow();this.retryInterval=window.setInterval((()=>s(this,void 0,void 0,(function*(){if(this.retryNumber>this.maxSearchEntry)clearInterval(this.retryInterval);else{if(window.__gpp=t.__gpp||window.__gpp,"function"==typeof window.__gpp){this.log("window.__gpp",window.__gpp);const t=yield(0,i.betterGpp)("ping");"loaded"===(null==t?void 0:t.cmpStatus)&&(this.getGPPData(),clearInterval(this.retryInterval))}this.retryNumber++}}))),this.retryTime)}checkGPPConsent(){return s(this,void 0,void 0,(function*(){if(this.log("checkGPPConsent"),"function"==typeof window.__gpp){if("loaded"===(yield(0,i.betterGpp)("ping")).cmpStatus)return void this.getGPPData()}this.createRetryInterval()}))}checkTCFConsent(){this.log("checkTCFConsent"),"function"==typeof window.__tcfapi&&(this.log("window.__tcfapi",window.__tcfapi),window.__tcfapi("addEventListener",2,((t,e)=>{this.tcfData={tcData:t,success:e},this.validateTCFData()})))}validateGPPData(t){var e,n,a;return s(this,void 0,void 0,(function*(){if(this.log("validateGPPData",t),!this.isCmpValid(t.cmpId))return this.consentStatus=o.REJECTED,void this.callCallback();if(this.isUiVisible(t.cmpDisplayStatus))return this.consentStatus=o.UNKNOWN,void this.callCallback();if(this.consentStatus=o.AGREED,null===(e=t.applicableSections)||void 0===e?void 0:e.length)for(const e of t.applicableSections){switch(e){case i.ESection.tcfeuv2:{const t=yield(0,i.checkAndGetSection)(i.ESection[i.ESection.tcfeuv2]);if(t){const e=((null===(n=t.VendorConsent)||void 0===n?void 0:n.includes(45))||(null===(a=t.VendorConsents)||void 0===a?void 0:a.includes(45)))&&[1,2,4,7,10].every((e=>{var n,s;return(null===(n=t.PurposeConsent)||void 0===n?void 0:n[e-1])||(null===(s=t.PurposeConsents)||void 0===s?void 0:s[e-1])}));e||(this.consentStatus=o.REJECTED)}break}case i.ESection.uspv1:{const t=yield(0,i.checkAndGetSection)(i.ESection[i.ESection.uspv1]);if(t){"Y"!==t.OptOutSale||(this.consentStatus=o.REJECTED)}break}case i.ESection.usnat:case i.ESection.usut:case i.ESection.usva:case i.ESection.usca:case i.ESection.usco:case i.ESection.usct:case i.ESection.usfl:case i.ESection.usmt:case i.ESection.usor:case i.ESection.ustx:{const t=yield(0,i.extendedGetSection)(i.ESection[e]);if(t){this.normalizeConsentArray(t);this.evaluateUsConsent(e,t)||(this.consentStatus=o.REJECTED)}break}default:this.consentStatus=o.UNKNOWN}if(this.consentStatus===o.REJECTED)break}this.consentStatus===o.UNKNOWN?this.checkTCFConsent():this.callCallback()}))}normalizeConsentArray(t){"number"==typeof t.KnownChildSensitiveDataConsents&&(t.KnownChildSensitiveDataConsents=[t.KnownChildSensitiveDataConsents])}evaluateUsConsent(t,e){let n=this.evaluateUsCommonConsent(e);if(!n)return n;const s=this.evaluateSet1Consent(e),o=this.evaluateSet2Consent(e),a=this.evaluateSet3Consent(e),c=this.evaluateSet4Consent(e),r=this.evaluateSet5Consent(e);switch(t){case i.ESection.usnat:n&&(n=s&&o);break;case i.ESection.usca:n&&(n=o);break;case i.ESection.usut:n&&(n=s);break;case i.ESection.usva:case i.ESection.usco:case i.ESection.usct:n&&(n=a);break;case i.ESection.usfl:case i.ESection.usor:case i.ESection.ustx:n&&(n=c);break;case i.ESection.usmt:n&&(n=r)}return n}evaluateUsCommonConsent(t){var e,n,s;return null!==(s=1!==t.SaleOptOut&&2!==t.SaleOptOutNotice&&(null===(e=t.KnownChildSensitiveDataConsents)||void 0===e?void 0:e.every((t=>1!==t)))&&(null===(n=t.SensitiveDataProcessing)||void 0===n?void 0:n.every((t=>1!==t))))&&void 0!==s&&s}evaluateSet1Consent(t){return 2!==t.SharingNotice&&1!==t.TargetedAdvertisingOptOut&&2!==t.TargetedAdvertisingOptOutNotice&&2!==t.SensitiveDataProcessingOptOutNotice}evaluateSet2Consent(t){return 1!==t.SharingOptOut&&2!==t.SharingOptOutNotice&&1!==t.PersonalDataConsents&&2!==t.SensitiveDataLimitUseNotice}evaluateSet3Consent(t){return 2!==t.SharingNotice&&1!==t.TargetedAdvertisingOptOut&&2!==t.TargetedAdvertisingOptOutNotice}evaluateSet4Consent(t){var e;return 2!==t.ProcessingNotice&&1!==t.TargetedAdvertisingOptOut&&2!==t.TargetedAdvertisingOptOutNotice&&(null===(e=t.AdditionalDataProcessingConsent)||void 0===e?void 0:e.every((t=>1!==t)))}evaluateSet5Consent(t){var e;return 2!==t.SharingNotice&&1!==t.TargetedAdvertisingOptOut&&2!==t.TargetedAdvertisingOptOutNotice&&(null===(e=t.AdditionalDataProcessingConsent)||void 0===e?void 0:e.every((t=>1!==t)))}callCallback(){this.log("callCallback"),"function"==typeof this.callback&&this.callback(this.consentStatus===o.REJECTED?this.consentTgtString:null),this.consentStatus===o.REJECTED&&Object.values(a).forEach((t=>window.sas.localStorage.removeItem(t))),this.consentStatus===o.UNKNOWN?window.sas.localStorage.removeItem(this.consentRejectedKey):window.sas.localStorage.setItem(this.consentRejectedKey,JSON.stringify(this.consentStatus))}isUiVisible(t){return this.log("isUiVisible",t),"cmpuishown"===t||"visible"===t}isCmpValid(t){const e=window.sas.cmpIds,n=!e||e.includes(t);return window.sas.localStorage.setItem(this.cmpValidKey,String(Number(n))),n}getTopWindow(){this.log("getTopWindow");let t=5,e=window;for(;t--;)try{e.parent&&e.parent.document&&(e=e.parent,e===e.parent&&(t=0))}catch(t){this.log("getTopWindow error",t)}return e}log(...t){this.logOn&&console.log("%cconsent","background:#ed5625; border-radius:2px; color:#feffff; font-family:lato,sans-serif; padding:1px 3px;",t)}},function(t){t[t.AGREED=0]="AGREED",t[t.REJECTED=1]="REJECTED",t[t.UNKNOWN=2]="UNKNOWN"}(o=e.EConsentStatus||(e.EConsentStatus={})),function(t){t.ID5="eqtv_id5",t.TOPICS="eqtv_topics",t.LIVERAMP="sas__lr_env"}(a=e.EModuleStorageKeys||(e.EModuleStorageKeys={}))},882:function(t,e){var n=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))((function(i,o){function a(t){try{r(s.next(t))}catch(t){o(t)}}function c(t){try{r(s.throw(t))}catch(t){o(t)}}function r(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}r((s=s.apply(t,e||[])).next())}))};function s(t,e){return new Promise((n=>{const s=window.__gpp(t,((t,e)=>{e&&n(t)}),e);void 0!==s&&n(s)}))}function i(t){return n(this,void 0,void 0,(function*(){if(yield s("hasSection",t)){const e=yield s("getSection",t);return Array.isArray(e)?e[0]:e}return null}))}Object.defineProperty(e,"__esModule",{value:!0}),e.extendedGetSection=e.checkAndGetSection=e.betterGpp=e.ESection=void 0,function(t){t[t.tcfeuv2=2]="tcfeuv2",t[t.uspv1=6]="uspv1",t[t.usnat=7]="usnat",t[t.usca=8]="usca",t[t.usva=9]="usva",t[t.usco=10]="usco",t[t.usut=11]="usut",t[t.usct=12]="usct",t[t.usfl=13]="usfl",t[t.usmt=14]="usmt",t[t.usor=15]="usor",t[t.ustx=16]="ustx"}(e.ESection||(e.ESection={})),e.betterGpp=s,e.checkAndGetSection=i,e.extendedGetSection=function(t){return n(this,void 0,void 0,(function*(){return(yield i(t))||(yield i(t+"v1"))}))}}},e={};function n(s){var i=e[s];if(void 0!==i)return i.exports;var o=e[s]={exports:{}};return t[s].call(o.exports,o,o.exports,n),o.exports}(()=>{const t=n(113);class e{constructor(t){this.sda=t,this.taxonomyMap={1:600,2:601,3:602,4:603,5:604,6:605,7:606,8:607,9:608,10:609},this.topics=[],this.iframe=document.createElement("iframe"),this.init()}init(){document.browsingTopics().then((t=>{this.addTopics(t)})),this.getFromStorage(),this.addIframe()}getFromStorage(){const e=window.sas.localStorage.getItem(t.EModuleStorageKeys.TOPICS);e&&this.sda.setSda(JSON.parse(e),!1)}addIframe(){this.iframe.src="https://ced-ns.sascdn.com/diff/js/assets/topics_frame.html",this.iframe.style.display="none",document.documentElement.appendChild(this.iframe),window.addEventListener("message",(t=>this.onMessageEvent(t)))}onMessageEvent(t){if(t.source===this.iframe.contentWindow&&"string"==typeof t.data)try{const e=JSON.parse(t.data);e.segment.topics.length&&this.addTopics(e.segment.topics)}catch(t){}}addTopics(e){if(e.length){const n=this.topics.length;if(this.topics.push(...e),this.topics=[...new Map(this.topics.map((t=>[JSON.stringify(t),t]))).values()],this.topics.length>n){const e=this.formatExtNode(this.topics);window.sas.localStorage.setItem(t.EModuleStorageKeys.TOPICS,JSON.stringify(e)),this.sda.removeSda("ext"),this.sda.setSda(e,!1)}}else this.topics.length||window.sas.localStorage.removeItem(t.EModuleStorageKeys.TOPICS)}formatExtNode(t){return Object.entries(this.groupByField("taxonomyVersion",t)).filter((([t])=>Object.prototype.hasOwnProperty.call(this.taxonomyMap,t))).map((([t,e])=>Object.entries(this.groupByField("modelVersion",e)).map((([e,n])=>({ext:{segtax:this.taxonomyMap[t],segclass:e},name:document.location.hostname,segment:n.map((t=>({id:t.topic.toString()})))}))))).reduce(((t,e)=>t.concat(e)),[])}groupByField(t,e){return e.reduce(((e,n)=>{const s=n[t];return Object.prototype.hasOwnProperty.call(e,s)||(e[s]=[]),e[s].push(n),e}),{})}}window.sas.Topics=e})()})();